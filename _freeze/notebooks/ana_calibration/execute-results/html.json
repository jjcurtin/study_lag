{
  "hash": "1a2f1f36ffeeec9ec250413080bd3b3b",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Model calibration\"\nauthor: \"Kendra Wyant\"\ndate: \"2025-06-20\"\noutput: \n  html_document:\n    toc: true \n    toc_depth: 4\nformat:\n  html:\n    embed-resources: true\neditor_options: \n  chunk_output_type: console\n---\n\n\n\n### Set Up Environment\n\n\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\nsuppressPackageStartupMessages(library(tidyverse))\nsuppressPackageStartupMessages(source(\"https://github.com/jjcurtin/lab_support/blob/main/format_path.R?raw=true\"))\nsuppressPackageStartupMessages(library(tidymodels))\n\npath_models <- format_path(\"risk/models/lag\")\n\noptions(knitr.kable.NA = '')\n```\n:::\n\n\n\n\n### Read in best model predicitons\n\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\npreds_0 <- read_rds(here::here(path_models, \"final_preds_kfold_1_x_5_1day_0_v3_strat_lh_final.rds\"))\npreds_24 <- read_rds(here::here(path_models, \"final_preds_kfold_1_x_5_1day_24_v3_strat_lh_final.rds\"))\npreds_72 <- read_rds(here::here(path_models, \"final_preds_kfold_1_x_5_1day_72_v3_strat_lh_final.rds\"))\npreds_168 <- read_rds(here::here(path_models, \"final_preds_kfold_1_x_5_1day_168_v3_strat_lh_final.rds\"))\npreds_336 <- read_rds(here::here(path_models, \"final_preds_kfold_1_x_5_1day_336_v3_strat_lh_final.rds\"))\n```\n:::\n\n\n\n\n### Brier Scores\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\nbrier <- tibble(model = \"No lag\",\n                raw = brier_class(preds_0, truth = label, prob_raw)$.estimate,\n                iso = brier_class(preds_0, truth = label, prob_iso)$.estimate,\n                logi = brier_class(preds_0, truth = label, prob_logi)$.estimate,\n                beta = brier_class(preds_0, truth = label, prob_beta)$.estimate) |> \n  bind_rows(tibble(model = \"1 day\",\n                   raw = brier_class(preds_24, truth = label, prob_raw)$.estimate,\n                   iso = brier_class(preds_24, truth = label, prob_iso)$.estimate,\n                   logi = brier_class(preds_24, truth = label, prob_logi)$.estimate,\n                   beta = brier_class(preds_24, truth = label, prob_beta)$.estimate)) |> \n  bind_rows(tibble(model = \"3 days\",\n                   raw = brier_class(preds_72, truth = label, prob_raw)$.estimate,\n                   iso = brier_class(preds_72, truth = label, prob_iso)$.estimate,\n                   logi = brier_class(preds_72, truth = label, prob_logi)$.estimate,\n                   beta = brier_class(preds_72, truth = label, prob_beta)$.estimate)) |> \n  bind_rows(tibble(model = \"1 week\",\n                   raw = brier_class(preds_168, truth = label, prob_raw)$.estimate,\n                   iso = brier_class(preds_168, truth = label, prob_iso)$.estimate,\n                   logi = brier_class(preds_168, truth = label, prob_logi)$.estimate,\n                   beta = brier_class(preds_168, truth = label, prob_beta)$.estimate)) |> \n  bind_rows(tibble(model = \"2 weeks\",\n                   raw = brier_class(preds_336, truth = label, prob_raw)$.estimate,\n                   iso = brier_class(preds_336, truth = label, prob_iso)$.estimate,\n                   logi = brier_class(preds_336, truth = label, prob_logi)$.estimate,\n                   beta = brier_class(preds_336, truth = label, prob_beta)$.estimate)) |> \n  write_csv(here::here(path_models, \"brier_scores.csv\"))\n\n\nbrier |> \n  rename(Model = model, \n         `Raw (uncalibrated)` = raw,\n         `Isotonic calibration` = iso,\n         `Logistic calibration` = logi,\n         `Beta calibration` = beta) |> \n  knitr::kable(digits = 2) |> \n  kableExtra::kable_classic()\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table class=\" lightable-classic\" style='font-family: \"Arial Narrow\", \"Source Sans Pro\", sans-serif; margin-left: auto; margin-right: auto;'>\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> Model </th>\n   <th style=\"text-align:right;\"> Raw (uncalibrated) </th>\n   <th style=\"text-align:right;\"> Isotonic calibration </th>\n   <th style=\"text-align:right;\"> Logistic calibration </th>\n   <th style=\"text-align:right;\"> Beta calibration </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> No lag </td>\n   <td style=\"text-align:right;\"> 0.07 </td>\n   <td style=\"text-align:right;\"> 0.04 </td>\n   <td style=\"text-align:right;\"> 0.04 </td>\n   <td style=\"text-align:right;\"> 0.04 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> 1 day </td>\n   <td style=\"text-align:right;\"> 0.07 </td>\n   <td style=\"text-align:right;\"> 0.05 </td>\n   <td style=\"text-align:right;\"> 0.05 </td>\n   <td style=\"text-align:right;\"> 0.05 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> 3 days </td>\n   <td style=\"text-align:right;\"> 0.13 </td>\n   <td style=\"text-align:right;\"> 0.06 </td>\n   <td style=\"text-align:right;\"> 0.06 </td>\n   <td style=\"text-align:right;\"> 0.05 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> 1 week </td>\n   <td style=\"text-align:right;\"> 0.07 </td>\n   <td style=\"text-align:right;\"> 0.06 </td>\n   <td style=\"text-align:right;\"> 0.06 </td>\n   <td style=\"text-align:right;\"> 0.06 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> 2 weeks </td>\n   <td style=\"text-align:right;\"> 0.08 </td>\n   <td style=\"text-align:right;\"> 0.06 </td>\n   <td style=\"text-align:right;\"> 0.06 </td>\n   <td style=\"text-align:right;\"> 0.06 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n",
    "supporting": [
      "ana_calibration_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<script src=\"../site_libs/kePrint-0.0.1/kePrint.js\"></script>\n<link href=\"../site_libs/lightable-0.0.1/lightable.css\" rel=\"stylesheet\" />\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}