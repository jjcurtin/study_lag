{
  "hash": "bd0bd337e64d3a0640c96f1c8f34afee",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Make All Tables for Main Manuscript\"\nauthor: \"Kendra Wyant\"\ndate: \"2025-01-27\"\nnumber-sections: true\noutput: \n  html_document:\n    toc: true \n    toc_depth: 4\nformat:\n  html:\n    embed-resources: true\n    toc: true\n    toc-depth: 4\neditor_options: \n  chunk_output_type: console\nhtml-table-processing: none\n---\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\n#| message: false\n#| warning: false\n\nsuppressPackageStartupMessages(library(tidyverse))\nsuppressPackageStartupMessages(source(\"https://github.com/jjcurtin/lab_support/blob/main/format_path.R?raw=true\"))\nsuppressPackageStartupMessages(library(tidyposterior))\nlibrary(kableExtra)\n```\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\n\nAttaching package: 'kableExtra'\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\nThe following object is masked from 'package:dplyr':\n\n    group_rows\n```\n\n\n:::\n\n```{.r .cell-code .hidden}\n#| message: false\n#| warning: false\n\npath_models_lag <- format_path(str_c(\"studydata/risk/models/lag\"))\npath_shared <- format_path(\"studydata/risk/data_processed/shared\")\npath_processed <- format_path(\"studydata/risk/data_processed/lag\")\n\noptions(knitr.kable.NA = '')\n```\n:::\n\n\n\n\n\n\n## Data and calculations\n\nTable 1 \n\n\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\ndisposition <- read_csv(file.path(path_processed, \"disposition.csv\"), \n                        col_types = \"ccDDcccccccccc\")\n\nscreen <- read_csv(file.path(path_shared, \"screen.csv\"), \n                   col_types = cols()) |>\n  filter(subid %in% subset(disposition, analysis == \"yes\")$subid) |> \n  mutate(across(dsm5_1:dsm5_11, ~ recode(., \"No\" = 0, \"Yes\" = 1))) |>  \n  rowwise() |>  \n  mutate(dsm5_total = sum(c(dsm5_1, dsm5_2, dsm5_3, dsm5_4, dsm5_5, dsm5_6, dsm5_7, \n                              dsm5_8, dsm5_9, dsm5_10, dsm5_11))) |>  \n  ungroup()\n\nlapses <- read_csv(file.path(path_shared, \"lapses.csv\"), col_types = cols()) |>\n  filter(exclude == FALSE)\n\n# Calcs to make df for table 1 (demographics and clinical characteristics)\nn_total <- 151\n\ndem_age <- screen |>\n  summarise(mean = as.character(round(mean(dem_1, na.rm = TRUE), 1)),\n            SD = as.character(round(sd(dem_1, na.rm = TRUE), 1)),\n            min = as.character(min(dem_1, na.rm = TRUE)),\n            max = as.character(max(dem_1, na.rm = TRUE))) |>\n  mutate(var = \"Age\",\n         n = as.numeric(\"\"),\n         perc = as.numeric(\"\")) |>\n  select(var, n, perc, everything()) \n\ndem_sex <-  screen |>\n  select(var = dem_2) |>\n  group_by(var) |>\n  summarise(n = n()) |>\n  mutate(perc = (n / sum(n)) * 100) |> \n  add_row(var = \"Sex\", .before = 1)\n\ndem_race <- screen |>\n  select(var = dem_3) |>\n  mutate(var = fct_relevel(factor(var,\n                         c(\"American Indian/Alaska Native\", \"Asian\", \"Black/African American\",\n                           \"White/Caucasian\", \"Other/Multiracial\")))) |>\n  group_by(var) |>\n  summarise(n = n()) |>\n  mutate(perc = (n / sum(n)) * 100) |>\n  add_row(var = \"Race\", .before = 1)\n  \n  \ndem_ethnicity <- screen |>\n  select(var = dem_4) |>\n  mutate(var = case_when(var == \"No, I am not of Hispanic, Latino, or Spanish origin\" ~ \"No\",\n                         TRUE ~ \"Yes\"),\n         var = fct_relevel(factor(var, c(\"Yes\", \"No\")))) |>\n  group_by(var) |>\n  summarise(n = n()) |>\n  mutate(perc = (n / sum(n)) * 100) |>\n  add_row(var = \"Hispanic, Latino, or Spanish origin\", .before = 1)\n\ndem_education <- screen |>\n  select(var = dem_5) |>\n  mutate(var = fct_relevel(factor(var,\n                         c(\"Less than high school or GED degree\", \"High school or GED\",\n                           \"Some college\", \"2-Year degree\", \"College degree\", \"Advanced degree\")))) |>\n  group_by(var) |>\n  summarise(n = n()) |>\n  mutate(perc = (n / sum(n)) * 100) |>\n  add_row(var = \"Education\", .before = 1)\n\ndem_employment <- screen |>\n  select(var = dem_6, dem_6_1) |>\n  mutate(var = case_when(dem_6_1 == \"Full-time\" ~ \"Employed full-time\",\n                         dem_6_1 == \"Part-time\" ~ \"Employed part-time\",\n                         TRUE ~ var)) |>\n  mutate(var = fct_relevel(factor(var,\n                         c(\"Employed full-time\", \"Employed part-time\", \"Full-time student\",\n                           \"Homemaker\", \"Disabled\", \"Retired\", \"Unemployed\",\n                           \"Temporarily laid off, sick leave, or maternity leave\",\n                           \"Other, not otherwise specified\")))) |>\n  group_by(var) |>\n  summarise(n = n()) |>\n  mutate(perc = (n / sum(n)) * 100) |>\n  add_row(var = \"Employment\", .before = 1)\n\ndem_income <- screen |>\n  summarise(mean = format(round(mean(dem_7, na.rm = TRUE), 0), big.mark = \",\"),\n            SD = format(round(sd(dem_7, na.rm = TRUE), 0), big.mark = \",\"),\n            min =format(round(min(dem_7, na.rm = TRUE), 0), big.mark = \",\"),\n            max = format(round(max(dem_7, na.rm = TRUE), 0), scientific = FALSE, big.mark = \",\")) |>\n  mutate(var = \"Personal Income\",\n        n = as.numeric(\"\"),\n        perc = as.numeric(\"\"),\n        mean = str_c(\"$\", as.character(mean)),\n        SD = str_c(\"$\", as.character(SD)),\n        min = str_c(\"$\", as.character(min)),\n        max = as.character(max)) |>\n  select(var, n, perc, everything())\n\ndem_marital <- screen |>\n  select(var = dem_8) |>\n  mutate(var = case_when(var == \"Never Married\" ~ \"Never married\",\n                         TRUE ~ var)) |>\n  mutate(var = fct_relevel(factor(var,\n                         c(\"Never married\", \"Married\", \"Divorced\", \"Separated\",\n                           \"Widowed\")))) |>\n  group_by(var) |>\n  summarise(n = n()) |>\n  mutate(perc = (n / sum(n)) * 100) |> \n  add_row(var = \"Marital Status\", .before = 1)\n\ndem_aud <- screen |>\n  summarise(mean = as.character(round(mean(dsm5_total, na.rm = TRUE), 1)),\n            SD = as.character(round(sd(dsm5_total, na.rm = TRUE), 1)),\n            min = as.character(min(dsm5_total, na.rm = TRUE)),\n            max = as.character(max(dsm5_total, na.rm = TRUE))) |>\n  mutate(var = \"DSM-5 AUD Symptom Count\",\n         n = as.numeric(\"\"),\n         perc = as.numeric(\"\")) |>\n  select(var, n, perc, everything()) \n\nlapses_per_subid <- screen |>\n  select(subid) |>\n  left_join(lapses |>\n  janitor::tabyl(subid) |>\n  select(-percent), by = \"subid\") |>\n  mutate(n = if_else(is.na(n), 0, n),\n         lapse = if_else(n > 0, \"yes\", \"no\"))\n\nlapse_info <- lapses_per_subid |>\n  group_by(lapse) |>\n  rename(var = lapse) |>\n  mutate(var = factor(var, levels = c(\"yes\", \"no\"), labels = c(\"Yes\", \"No\"))) |>\n  summarise(n = n()) |>\n  mutate(perc = (n / n_total) * 100,\n         mean = NA_character_,\n         SD = NA_character_,\n         min = NA_character_,\n         max = NA_character_) |>\n  full_join(lapses_per_subid |>\n  summarise(mean = as.character(round(mean(n), 1)),\n            SD = as.character(round(sd(n), 1)),\n            min = as.character(round(min(n), 1)),\n            max = as.character(round(max(n), 1))) |>\n  mutate(var = \"Number of reported lapses\"),\n  by = c(\"var\", \"mean\", \"SD\", \"min\", \"max\")) |> \n  add_row(var = \"Reported 1 or More Lapse During Study Period\", .before = 1)\n\ntable_dem <- dem_age |> \n  bind_rows(dem_sex) |> \n  bind_rows(dem_race) |> \n  bind_rows(dem_ethnicity) |> \n  bind_rows(dem_education) |> \n  bind_rows(dem_employment) |> \n  bind_rows(dem_income) |> \n  bind_rows(dem_marital) |> \n  bind_rows(dem_aud) |> \n  bind_rows(lapse_info) |> \n  mutate(range = str_c(min, \"-\", max),\n         perc = round(perc, 1)) |> \n  select(-c(min, max)) |> \n  rename(N = n,\n         `%` = perc,\n         M = mean, \n         Range = range)\n```\n:::\n\n\n\n\n\nTable 2\n\n\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\nci_baseline <- read_csv(here::here(path_models_lag, \"contrast_baseline.csv\"), \n                        col_types = cols())\n\nci_lag <- read_csv(here::here(path_models_lag, \"contrast_adjacent.csv\"), \n                   col_types = cols())\n\ntable_ci <- ci_baseline |> \n  mutate(ci = str_c(\"[\", round(lower, 3), \", \", round(upper, 3), \"]\"),\n         median = as.character(round(median, 3)),\n         probability = as.character(round(probability, 3))) |> \n  select(contrast, median, ci, probability) |> \n  add_row(contrast = \"Baseline Contrasts\", median = \"\", ci = \"\", probability = \"\") |> \n  mutate(contrast = factor(contrast,\n                           levels = c(\"Baseline Contrasts\",\n                                      \"0 vs. 24\",\n                                      \"0 vs. 72\",\n                                      \"0 vs. 168\",\n                                      \"0 vs. 336\"))) |> \n  arrange(contrast) |> \n  rbind(ci_lag |> \n          mutate(ci = str_c(\"[\", round(lower, 3), \", \", round(upper, 3), \"]\"),\n                  median = as.character(round(median, 3)),\n         probability = as.character(round(probability, 3))) |>\n          select(contrast, median, ci, probability) |> \n          add_row(contrast = \"Adjacent Contrasts\", median = \"\", ci = \"\", \n                  probability = \"\") |> \n          mutate(contrast = factor(contrast,\n                           levels = c(\"Adjacent Contrasts\",\n                                      \"24 vs. 72\",\n                                      \"72 vs. 168\",\n                                      \"168 vs. 336\"))) |> \n          arrange(contrast)) |> \n  rename(Contrast = contrast,\n         Median = median,\n         `Bayesian CI` = ci,\n         Probability = probability)\n```\n:::\n\n\n\n\n\n\n### Table 1: Demographic and Lapse Characteristics\n\n\n\n\n\n::: {#tbl-demohtml .cell tbl-cap='Demographic and Lapse Characteristics'}\n\n```{.r .cell-code .hidden}\n#| label: tbl-demohtml\n#| tbl-cap: \"Demographic and Lapse Characteristics\"\n\ntable_dem |> \n  knitr::kable()\n```\n\n::: {.cell-output-display}\n\n\n|var                                                  |   N|    %|M       |SD      |Range      |\n|:----------------------------------------------------|---:|----:|:-------|:-------|:----------|\n|Age                                                  |    |     |41      |11.9    |21-72      |\n|Sex                                                  |    |     |        |        |           |\n|Female                                               |  74| 49.0|        |        |           |\n|Male                                                 |  77| 51.0|        |        |           |\n|Race                                                 |    |     |        |        |           |\n|American Indian/Alaska Native                        |   3|  2.0|        |        |           |\n|Asian                                                |   2|  1.3|        |        |           |\n|Black/African American                               |   8|  5.3|        |        |           |\n|White/Caucasian                                      | 131| 86.8|        |        |           |\n|Other/Multiracial                                    |   7|  4.6|        |        |           |\n|Hispanic, Latino, or Spanish origin                  |    |     |        |        |           |\n|Yes                                                  |   4|  2.6|        |        |           |\n|No                                                   | 147| 97.4|        |        |           |\n|Education                                            |    |     |        |        |           |\n|Less than high school or GED degree                  |   1|  0.7|        |        |           |\n|High school or GED                                   |  14|  9.3|        |        |           |\n|Some college                                         |  41| 27.2|        |        |           |\n|2-Year degree                                        |  14|  9.3|        |        |           |\n|College degree                                       |  58| 38.4|        |        |           |\n|Advanced degree                                      |  23| 15.2|        |        |           |\n|Employment                                           |    |     |        |        |           |\n|Employed full-time                                   |  72| 47.7|        |        |           |\n|Employed part-time                                   |  26| 17.2|        |        |           |\n|Full-time student                                    |   7|  4.6|        |        |           |\n|Homemaker                                            |   1|  0.7|        |        |           |\n|Disabled                                             |   7|  4.6|        |        |           |\n|Retired                                              |   8|  5.3|        |        |           |\n|Unemployed                                           |  18| 11.9|        |        |           |\n|Temporarily laid off, sick leave, or maternity leave |   3|  2.0|        |        |           |\n|Other, not otherwise specified                       |   9|  6.0|        |        |           |\n|Personal Income                                      |    |     |$34,298 |$31,807 |$0-200,000 |\n|Marital Status                                       |    |     |        |        |           |\n|Never married                                        |  67| 44.4|        |        |           |\n|Married                                              |  32| 21.2|        |        |           |\n|Divorced                                             |  45| 29.8|        |        |           |\n|Separated                                            |   5|  3.3|        |        |           |\n|Widowed                                              |   2|  1.3|        |        |           |\n|DSM-5 AUD Symptom Count                              |    |     |8.9     |1.9     |4-11       |\n|Reported 1 or More Lapse During Study Period         |    |     |        |        |           |\n|Yes                                                  |  84| 55.6|        |        |           |\n|No                                                   |  67| 44.4|        |        |           |\n|Number of reported lapses                            |    |     |6.8     |12      |0-75       |\n\n\n:::\n:::\n\n\n\n\n### Table 2: Model Comparisons\n\n\n\n\n::: {#tbl-contrast .cell tbl-cap='Median difference in auROC, 95% Bayesian credible interval (CI), and posterior probability that that the auROC difference was greater than 0 for all baseline and adjacent lag contrasts.'}\n\n```{.r .cell-code .hidden}\n#| label: tbl-contrast\n#| tbl-cap: \"Median difference in auROC, 95% Bayesian credible interval (CI), and posterior probability that that the auROC difference was greater than 0 for all baseline and adjacent lag contrasts.\"\n\ntable_ci |> \n  knitr::kable()\n```\n\n::: {.cell-output-display}\n\n\n|Contrast           |Median |Bayesian CI    |Probability |\n|:------------------|:------|:--------------|:-----------|\n|Baseline Contrasts |       |               |            |\n|0 vs. 24           |0.02   |[0.013, 0.027] |1           |\n|0 vs. 72           |0.032  |[0.025, 0.04]  |1           |\n|0 vs. 168          |0.043  |[0.035, 0.051] |1           |\n|0 vs. 336          |0.064  |[0.054, 0.074] |1           |\n|Adjacent Contrasts |       |               |            |\n|24 vs. 72          |0.012  |[0.005, 0.02]  |0.998       |\n|72 vs. 168         |0.01   |[0.003, 0.018] |0.986       |\n|168 vs. 336        |0.021  |[0.012, 0.03]  |1           |\n\n\n:::\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}